language: python
python: '3.7'
dist: xenial

cache:
  directories:
    - "$HOME/.cache/pip"

install:
  - pip install nox

script: nox --non-interactive --session lint test

before_deploy:
  - openssl aes-256-cbc -K $encrypted_89a54a178b1d_key -iv $encrypted_89a54a178b1d_iv -in instance.tar.enc -out instance.tar -d
  - tar xvf instance.tar

deploy:
  provider: gae
  keyfile: "instance/service-account.json"
  project: tapeworm-bot
  skip_cleanup: true
  on:
    branch: master
    tags: true